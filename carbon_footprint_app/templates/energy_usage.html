<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Usage des Sources d'Énergie</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
</head>
<body>
    <h1>Classement des Pays par Usage des Sources d'Énergie</h1>
    <label for="energy-source">Sélectionnez une source d'énergie :</label>
    <select id="energy-source" onchange="updateChart()">
        <option value="coal_emissions" {% if energy_source == 'coal_emissions' %}selected{% endif %}>Charbon</option>
        <option value="gas_emissions" {% if energy_source == 'gas_emissions' %}selected{% endif %}>Gaz</option>
        <option value="oil_emissions" {% if energy_source == 'oil_emissions' %}selected{% endif %}>Pétrole</option>
        <option value="hydro_emissions" {% if energy_source == 'hydro_emissions' %}selected{% endif %}>Hydroélectricité</option>
        <option value="renewable_emissions" {% if energy_source == 'renewable_emissions' %}selected{% endif %}>Renouvelables</option>
        <option value="nuclear_emissions" {% if energy_source == 'nuclear_emissions' %}selected{% endif %}>Nucléaire</option>
    </select>
    <div id="bar-chart"></div>

    <script>
        var data = {
            country: {{ data['country']|tojson }},
            coal_emissions: {{ data['coal_emissions']|tojson }},
            gas_emissions: {{ data['gas_emissions']|tojson }},
            oil_emissions: {{ data['oil_emissions']|tojson }},
            hydro_emissions: {{ data['hydro_emissions']|tojson }},
            renewable_emissions: {{ data['renewable_emissions']|tojson }},
            nuclear_emissions: {{ data['nuclear_emissions']|tojson }}
        };

        function getColorScale(energySource) {
            switch (energySource) {
                case 'coal_emissions':
                    return ['#d3d3d3', '#a9a9a9']; // Dégradé de gris clair
                case 'gas_emissions':
                    return ['#ffcc99', '#ff6600']; // Dégradé d'orange
                case 'oil_emissions':
                    return ['#a9a9a9', '#696969']; // Dégradé de gris foncé
                case 'hydro_emissions':
                    return ['#99ccff', '#0066cc']; // Dégradé de bleu
                case 'renewable_emissions':
                    return ['#e6ccff', '#9933cc']; // Dégradé de violet
                case 'nuclear_emissions':
                    return ['#99ff99', '#009933']; // Dégradé de vert
                default:
                    return ['#ffffff', '#000000']; // Dégradé par défaut
            }
        }

        function updateChart() {
            var energySource = document.getElementById('energy-source').value;
            var sortedData = data.country.map((country, index) => ({
                country: country,
                value: data[energySource][index]
            })).sort((a, b) => b.value - a.value);

            var includedData = sortedData.filter(item => item.value > 0);
            var excludedData = sortedData.filter(item => item.value === 0);

            var colorScale = getColorScale(energySource);
            var colors = includedData.map(item => {
                var ratio = item.value / Math.max(...includedData.map(d => d.value));
                return `rgba(${parseInt(colorScale[0].slice(1, 3), 16) * (1 - ratio) + parseInt(colorScale[1].slice(1, 3), 16) * ratio}, ${parseInt(colorScale[0].slice(3, 5), 16) * (1 - ratio) + parseInt(colorScale[1].slice(3, 5), 16) * ratio}, ${parseInt(colorScale[0].slice(5, 7), 16) * (1 - ratio) + parseInt(colorScale[1].slice(5, 7), 16) * ratio}, 1)`;
            });

            var chartData = [{
                x: includedData.map(item => item.country),
                y: includedData.map(item => item.value),
                type: 'bar',
                text: includedData.map(item => item.country), // Ajout des pays dans les info-bulles
                hoverinfo: 'text+y', // Affichage des pays et des valeurs dans les info-bulles
                marker: { color: colors } // Application des couleurs
            }];

            var layout = {
                title: 'Usage des Sources d\'Énergie par Pays',
                xaxis: { 
                    title: 'Pays',
                    showticklabels: false // Retirer les étiquettes des pays de l'axe des x
                },
                yaxis: { 
                    title: 'Pourcentage de ' + energySource.replace('_emissions', '') + ' dans la production d\'électricité',
                    type: 'log' // Utilisation d'une échelle logarithmique
                }
            };

            Plotly.newPlot('bar-chart', chartData, layout);

        }

        // Initial chart
        updateChart();
    </script>
</body>
</html>
